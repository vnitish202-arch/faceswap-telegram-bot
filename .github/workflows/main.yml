name: Telegram FaceSwap Bot - Auto Run

on:
  push:
    branches: ["main"]

  workflow_dispatch:

  # Auto restart every 4 hours
  schedule:
    - cron: "0 */4 * * *"

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:

      # 1. Checkout repository
      - name: Checkout Repo
        uses: actions/checkout@v3

      # 2. Install system-level dependencies
      - name: Install System Dependencies
        run: |
          sudo apt update
          sudo apt install -y python3 python3-pip python3-dev python3-setuptools
          sudo apt install -y cmake g++ make
          sudo apt install -y libboost-all-dev
          sudo apt install -y libopenblas-dev liblapack-dev
          sudo apt install -y libjpeg-dev zlib1g-dev

      # 3. Install Python deps
      - name: Install Python Libraries
        run: |
          python3 -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. Run bot
      - name: Start Telegram Bot
        timeout-minutes: 350    # 5 hours runtime
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          ADMIN_CHAT_ID: ${{ secrets.ADMIN_CHAT_ID }}
        run: |
          python3 consensual_face_swap_bot.py
